[1mdiff --git a/.gitignore b/.gitignore[m
[1mindex 7fe978f8..7975c600 100755[m
[1m--- a/.gitignore[m
[1m+++ b/.gitignore[m
[36m@@ -9,6 +9,11 @@[m
 .env.backup[m
 .env.production[m
 .phpunit.result.cache[m
[32m+[m[32m.docker-compose.yaml[m
[32m+[m[32m.docker-compose-dev.yaml[m
[32m+[m[32m.docker-compose-prod.yml[m
[32m+[m[32m/storage/log[m
[32m+[m[32m/storage/framework[m
 Homestead.json[m
 Homestead.yaml[m
 auth.json[m
[1mdiff --git a/app/Http/Controllers/ApiController.php b/app/Http/Controllers/ApiController.php[m
[1mindex 6a18d9b1..29cfa581 100755[m
[1m--- a/app/Http/Controllers/ApiController.php[m
[1m+++ b/app/Http/Controllers/ApiController.php[m
[36m@@ -9,6 +9,7 @@[m
 use App\Models\Rate;[m
 use App\Models\Controller;[m
 use Carbon\Carbon;[m
[32m+[m[32muse ProtoneMedia\LaravelFFMpeg\Support\FFMpeg;[m
 [m
 class ApiController extends Controller[m
 {[m
[36m@@ -124,6 +125,11 @@[m [mpublic static function sendNewTransportToControllers($transport) {[m
                 'request_id' => Carbon::now()->format('Ymdhms'),[m
                 'ev_date' => Carbon::now()->format('Y.m.d H:m:s'),[m
                 'create' => [ [m
[32m+[m[32m                    'parent' => [[m
[32m+[m[32m                        'name' => $transport->tenant->name,[m
[32m+[m[32m                        'id' => $transport->tenant->id,[m
[32m+[m[32m                        'access' => $transport->balance <= 0 ? 0 : 1,[m[41m [m
[32m+[m[32m                    ],[m
                     'plate' => $transport->number,[m
                     'fio' => $transport->driver,[m
                     'access' => intval($transport->access),[m
[36m@@ -131,8 +137,8 @@[m [mpublic static function sendNewTransportToControllers($transport) {[m
                 'access' => [[m
                     'time_limit' => intval($transport->time_limit),[m
                     'week' => $week,[m
[31m-                    'time_interval' => str_replace([':'], '', $transport->fromDate) .'-'.str_replace([':'], '', $transport->toDate),[m
[31m-                    'date_interval' => Carbon::parse($transport->fromDate)->format('Ymd').'-'.Carbon::parse($transport->toDate)->format('Ymd'),[m
[32m+[m[32m                    'time_interval' => str_replace([':'], '', $transport->fromTime) .'-'.str_replace([':'], '', $transport->toTime),[m
[32m+[m[32m                    'date_interval' => (isset($transport->fromDate) ? Carbon::parse($transport->fromDate)->format('Ymd') : Carbon::now()->format('Ymd')).'-'. (isset($transport->toDate) ? Carbon::parse($transport->toDate)->format('Ymd') : '21191231'),[m
                 ][m
             ];[m
 [m
[36m@@ -168,8 +174,10 @@[m [mpublic static function sendNewTransportToControllers($transport) {[m
     }[m
 [m
     public function test_createTransport(Request $request) {        [m
[31m-        $transport = Transport::where('number', $request->plate)->first();[m
[31m-        //dd($transport);[m
[32m+[m[32m        $transport = Transport::where('number', 'A456OA25')->first();[m
[32m+[m[32m        if (!isset($transport)) {[m
[32m+[m[32m            return response()->json(['message' => 'ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾ Ð°Ð²Ñ‚Ð¾'], 200);[m
[32m+[m[32m        }[m
         $week = '';[m
         foreach ($transport->week as $key => $value) {[m
             $week .= ($value == 1) ? '1':'0';[m
[36m@@ -179,6 +187,11 @@[m [mpublic function test_createTransport(Request $request) {[m
             'request_id' => Carbon::now()->format('Ymdhms'),[m
             'ev_date' => Carbon::now()->format('Y.m.d H:m:s'),[m
             'create' => [ [m
[32m+[m[32m                'parent' => [[m
[32m+[m[32m                        'name' => $transport->tenant->name,[m
[32m+[m[32m                        'id' => $transport->tenant->id,[m
[32m+[m[32m                        'access' => $transport->balance <= 0 ? 0 : 1,[m[41m [m
[32m+[m[32m                    ],[m
                 'plate' => $transport->number,[m
                 'fio' => $transport->driver,[m
                 'access' => $transport->access == 'enable' ? 1: 0,[m
[36m@@ -193,4 +206,36 @@[m [mpublic function test_createTransport(Request $request) {[m
 [m
         return response()->json($data, 200);[m
     }[m
[32m+[m
[32m+[m[32m    public function ffmpeg() {[m
[32m+[m[32m        info('ffmpeg');[m
[32m+[m[32m        // FFMpeg::openUrl('rtsp://test:123456789qQ@5.165.25.145:55554')[m
[32m+[m[32m        // ->export()[m
[32m+[m[32m        // ->inFormat(new X264)[m
[32m+[m[32m        // ->concatWithTranscoding($hasVideo = true, $hasAudio = true)[m
[32m+[m[32m        // ->save('concat.mp4');[m
[32m+[m[32m        // FFMpeg::openUrl('rtsp://test:123456789qQ@5.165.25.145:55554')[m
[32m+[m[32m        //     ->export()[m
[32m+[m[32m        //     ->onProgress(function ($percentage) {[m
[32m+[m[32m        //         echo "{$percentage}% transcoded";[m
[32m+[m[32m        //     });[m
[32m+[m
[32m+[m[32m        $lowBitrate = (new \FFMpeg\Format\Video\X264)->setKiloBitrate(250);[m
[32m+[m[32m        $midBitrate = (new \FFMpeg\Format\Video\X264)->setKiloBitrate(500);[m
[32m+[m[32m        $highBitrate = (new \FFMpeg\Format\Video\X264)->setKiloBitrate(1000);[m
[32m+[m
[32m+[m[32m        FFMpeg::$transport->fromDate[m
[32m+[m[32m        ->openUrl('rtsp://test:123456789qQ@5.165.25.145:55554')[m
[32m+[m[32m        ->exportForHLS()[m
[32m+[m[32m        ->toDisk('public')[m
[32m+[m[32m        ->setSegmentLength(10) // optional[m
[32m+[m[32m        ->setKeyFrameInterval(48) // optional[m
[32m+[m[32m        ->addFormat($lowBitrate)[m
[32m+[m[32m        ->addFormat($midBitrate)[m
[32m+[m[32m        ->addFormat($highBitrate)[m
[32m+[m[32m        ->save('adaptive_steve.m3u8');[m
[32m+[m
[32m+[m[32m        return 'ok';[m
[32m+[m[41m        [m
[32m+[m[32m    }[m
 }[m
[1mdiff --git a/app/Nova/Transport.php b/app/Nova/Transport.php[m
[1mindex b5ba2425..ce67a066 100755[m
[1m--- a/app/Nova/Transport.php[m
[1m+++ b/app/Nova/Transport.php[m
[36m@@ -174,7 +174,7 @@[m [mprotected function scheduleFields()[m
         return [[m
             // Boolean::make('Ð“Ð¾ÑÑ‚ÐµÐ²Ð¾Ð¹', 'guest'),[m
             [m
[31m-            AdvancedNumber::make('ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾ Ñ‚Ð°Ð¹Ð°ÑƒÑ‚Ñƒ', 'time_limit')->default(0)->step(1)->hideFromIndex()->help('Ð—Ð°Ð´Ð°Ñ‘Ñ‚ÑÑ Ð² Ñ‡Ð°ÑÐ°Ñ…'),[m
[32m+[m[32m            AdvancedNumber::make('ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ñƒ', 'time_limit')->default(0)->step(1)->hideFromIndex()->help('Ð—Ð°Ð´Ð°Ñ‘Ñ‚ÑÑ Ð² Ñ‡Ð°ÑÐ°Ñ…'),[m
             TimeRange::make('Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»', ['fromTime', 'toTime'])->hideFromIndex(),[m
             DateRange::make('ÐŸÐµÑ€Ð¸Ð¾Ð´', ['fromDate', 'toDate'])->hideFromIndex(),[m
             BooleanGroup::make('Ð”Ð½Ð¸ Ð½ÐµÐ´ÐµÐ»Ð¸', 'week')->options([[m
[1mdiff --git a/routes/api.php b/routes/api.php[m
[1mindex 266fc59e..7b8a98e8 100755[m
[1m--- a/routes/api.php[m
[1m+++ b/routes/api.php[m
[36m@@ -18,6 +18,7 @@[m
 Route::post('event', [ApiController::class, 'event']); [m
 Route::post('ckassa/callback', [CkassaController::class, 'callback']);[m
 Route::get('test_ctreate_transport', [ApiController::class, 'test_createTransport']);[m
[32m+[m[32mRoute::get('ffmpeg', [ApiController::class, 'ffmpeg']);[m
 [m
 // Route::group(['middleware' => 'auth:sanctum'], function () {[m
 //     Route::post('event', [ApiController::class, 'event']); [m
[1mdiff --git a/storage/app/public/.gitignore b/storage/app/public/.gitignore[m
[1mdeleted file mode 100755[m
[1mindex d6b7ef32..00000000[m
[1m--- a/storage/app/public/.gitignore[m
[1m+++ /dev/null[m
[36m@@ -1,2 +0,0 @@[m
[31m-*[m
[31m-!.gitignore[m
[1mdiff --git a/storage/framework/cache/data/d2/47/d247e105fe736b90a61bbe809c626850ac524ad7 b/storage/framework/cache/data/d2/47/d247e105fe736b90a61bbe809c626850ac524ad7[m
[1mindex 3feb61f3..4b06c65a 100644[m
[1m--- a/storage/framework/cache/data/d2/47/d247e105fe736b90a61bbe809c626850ac524ad7[m
[1m+++ b/storage/framework/cache/data/d2/47/d247e105fe736b90a61bbe809c626850ac524ad7[m
[36m@@ -1 +1 @@[m
[31m-1698657471i:2;[m
\ No newline at end of file[m
[32m+[m[32m1698744817i:1;[m
\ No newline at end of file[m
[1mdiff --git a/storage/framework/cache/data/eb/6c/eb6ca53768b7b633032cbfaf483a5c78a72c95c9 b/storage/framework/cache/data/eb/6c/eb6ca53768b7b633032cbfaf483a5c78a72c95c9[m
[1mindex eb995cff..4a0a57d2 100644[m
[1m--- a/storage/framework/cache/data/eb/6c/eb6ca53768b7b633032cbfaf483a5c78a72c95c9[m
[1m+++ b/storage/framework/cache/data/eb/6c/eb6ca53768b7b633032cbfaf483a5c78a72c95c9[m
[36m@@ -1 +1 @@[m
[31m-1698657471i:1698657471;[m
\ No newline at end of file[m
[32m+[m[32m1698744817i:1698744817;[m
\ No newline at end of file[m
